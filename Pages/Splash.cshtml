@page "/splash"
@model SplashModel
<div class="text-center container">
  <h1>Acid December</h1>

  @*     <div class="video-container">
        <video id="splashVideo" width="1200px" height="670px" controls background="black" style="object-fit: cover;"
            border="0">
            <source src="https://storage.googleapis.com/acid-december2012/2024/Aci2web.mp4" type="video/mp4" />
            <!-- This is A acid house video -->
        </video>
    </div>

    @section Scripts {
        <script>
            const vid = document.getElementById("splashVideo");
            vid.addEventListener("ended", function () {
                window.location.href = "/2024"; // Adjust path as needed
            });
        </script>
    }
 *@/

  <h2>The Ã†ther is Humming. Acid December Approaches.</h2>


  <p>Greetings, Time-Travelers, Circuit-Benders, and Sonic Alchemists!<br />

    The ancient digital calendar is ticking. The cosmic compulsion is setting in. You feel it, don't you? That primal
    urge to forge a track in the searing crucible of ACID and cast it into the datastream.
    <br /><br />
    Acid December is upon us.
    <br /><br />
    This thousand-year-old tradition demands your submission. We are assembling the annual sonic grimoire, a track-a-day
    ritual that will carry us through the liminal space and into the 36th of December.
    <br /><br />
    The Portal is Open: Transmit all audio files to the secure terminal over email to <b>acid@datapop.se</b>. The email
    shall contain a downloadable track, a title, an artist name, an image and a link to your interwebz
    <br /><br />
    Send us your squelching basslines, your hypnotic sequences, your glitched-out dreams. Send us the sound of a robot
    weeping in a rainstorm. Send us the pulse of a forgotten satellite. Send us acid.
    <br /><br />
    The Timeline:
    <br /><br />
    <b>NOW:</b> Start rendering. Start twisting knobs. The compulsion is real.
    <br /><br />
    <b>December 1st:</b> The first track drops, and the ritual begins.
    <br /><br />
    <b>December 31st 00:00 UTC:</b> We achieve temporal lift-off. Probably.
    <br /><br />
    Do not resist the call. The future-past of music depends on you. Add your name to the list below and let's make this
    millennium the best one yet.
  </p>

<h2>Tools</h2>
<p>But how to create the acid tracks, you ask? Fear not, for we have compiled a list of tools to help you on your journey into the depths of sonic alchemy:
<br />Use a clone, use a clone of a clone of a clone. Use hardware, use software. Use free, use paid. Use vintage, use modern. Use whatever you have at your disposal
</p><div class="row">
  <div class="col-4">
  <a href="https://github.com/boomlinde/pocketacid" target="_blank">
    <img src="/img/r36xx_small.jpg" alt="R36xx" style="width:100%;height:200px;" /></a>
    <h4>Pocket Acid</h4> 
</div>
  <div class="col-4">
  <a href="https://woolyss.com/chipmusic/chipmusic-generators/TS-404.zip" target="_blank">
    <img src="/img/ts-404.gif" alt="TS-404" style="width:100%;height:200px;" /></a>
    <h4>TS-404</h4>
</div>  <div class="col-4">
  <a href="https://gearloop.se/?q=303" target="_blank">
    <img src="/img/303606.jpg" alt="303606" style="width:100%;height:200px;" /></a>
    <h4>The real stuff</h4>
</div>
<div class="col-4">
  <a href="https://sites.google.com/view/jennyrave-303-ghetto-pro-v-2-0" target="_blank">
    <img src="/img/ghetto303.png" alt="Jennyrave Ghetto 303" style="width:100%;height:200px;" /></a>
    <h4>Jennyrave Ghetto 303</h4>
</div>



<div class="col-12">
  @foreach (AcidDec.Models.Song artist in Model?.Artists)
  {
    var artistKey = artist.Artist.Replace(" ", "_").Replace("\"", "").Replace("'", "");
    <div class="col-12">
      <h3>

        <div class="artist-entry">
          <span class="artist-name" data-artist="@artistKey">@artist.Artist</span>

        </div>
        <div class="song-entries" data-artist="@artistKey" style="display:none;">
          @foreach (AcidDec.Models.Song song in Model?.Songs ?? new List<AcidDec.Models.Song>())
          {
            @if (song.Artist == artist.Artist)
            {
              <div class="song-entry" data-publishdate='@song.Publishdate?.ToDateTime().ToString("dd.MM.yyyy")'>
                <strong>@song.Title</strong>
                <br />
                @song.Publishdate?.ToDateTime().ToString("yyyy")
                <br />
                <audio id="audio-@song.Id" src="@song.Tune"></audio>
                <button type="button" class="play-btn" data-audio="audio-@song.Id">Play</button>
                @if (!string.IsNullOrEmpty(artist.Artistlink))
                {
                  <button onclick="window.open('https://@artist.Artistlink', '_blank')">More</button>
                }
              </div>
            }
          }
        </div>
    </div>
  }
  </h3>

  <div class="col-12">
    <div id="control" style="display:none;">
      <!-- show current song info -->
      <audio id="music">
        <h1>Your browser isn't ready for so much hotness. Use the download-link instead.</h1>.
      </audio>

      <div id="audioplayer">
        @*  <button id="pButton" class="play"></button> *@
        <div id="timeline">
          <div id="playhead"></div>
        </div>
      </div>
      <div id="current-track" style="margin-top:12px;" show>
        <h3>Now Playing:
          <strong id="current-title"></strong>
          by
          <span id="current-artist"></span>
          from
          <span id="current-publishdate"></span>
        </h3>
      </div>
      <div class="skip">
        @*   <button id="prev" class="skipbtn">Prev</button>
        <button id="next" class="skipbtn">Next</button>
 *@
      </div>

      <div id="random_posts"> </div>


    </div>


  </div>

</div>

<!-- do not load any audio before the play button is pressed -->
</div>
@section Scripts {
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let currentAudio = null;

      function updateCurrentTrackDisplay(title, artist, publishdate) {
        document.getElementById('current-title').textContent = title || '';
        document.getElementById('current-artist').textContent = artist || '';
        document.getElementById('current-publishdate').textContent = publishdate || '';
      }

      // Pause all other audios
      function pauseAllExcept(exceptEl) {
        document.querySelectorAll('audio').forEach(function (a) {
          if (a !== exceptEl) {
            try { a.pause(); } catch (e) { }
          }
        });
      }

      document.querySelectorAll(".play-btn").forEach(function (btn) {
        btn.addEventListener("click", function () {
          const audioId = btn.getAttribute("data-audio");
          const audio = document.getElementById(audioId);

          // Find song title inside the same .song-entry
          const songEntry = btn.closest('.song-entry');
          const titleElem = songEntry ? songEntry.querySelector('strong') : null;
          const title = titleElem ? titleElem.textContent.trim() : '';

          // get publish date from data attribute on .song-entry
          let publishdate = '';
          if (songEntry) {
            publishdate = songEntry.getAttribute('data-publishdate') || '';
          }

          // Find artist name via the container data-artist
          let artist = '';
          const songEntriesContainer = btn.closest('.song-entries');
          if (songEntriesContainer) {
            const artistKey = songEntriesContainer.getAttribute('data-artist');
            const artistElem = document.querySelector(`.artist-name[data-artist='${artistKey}']`);
            if (artistElem) artist = artistElem.textContent.trim();
          }

          if (!audio) return;

          if (audio.paused) {
            // pause others, then play this one
            pauseAllExcept(audio);
            audio.play().catch(() => { /* ignore play errors (autoplay policy) */ });
            btn.textContent = "Stop";
            updateCurrentTrackDisplay(title, artist, publishdate);
            currentAudio = audio;
          } else {
            audio.pause();
            btn.textContent = "Play";
            // Clear display when paused only if this was the current audio
            if (currentAudio === audio) {
              updateCurrentTrackDisplay('', '', '');
              currentAudio = null;
            }
          }
        });

        // Keep button text in sync when audio ends or is paused externally
        const audioId = btn.getAttribute("data-audio");
        const audioEl = document.getElementById(audioId);
        if (audioEl) {
          audioEl.addEventListener('ended', function () {
            btn.textContent = 'Play';
            if (document.getElementById('current-title').textContent) {
              // clear display when track ends
              updateCurrentTrackDisplay('', '', '');
              currentAudio = null;
            }
          });
          audioEl.addEventListener('pause', function () {
            btn.textContent = 'Play';
            document.getElementById('control').style.display = 'none';
          });
          audioEl.addEventListener('play', function () {
            btn.textContent = 'Stop';
            document.getElementById('control').style.display = 'block';
          });
        }
      });
    });
  </script>
  <!-- Toggle artist songs display -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".artist-name").forEach(function (artistElem) {
        artistElem.addEventListener("click", function () {
          const artistKey = artistElem.getAttribute("data-artist");
          const songEntries = document.querySelector(`.song-entries[data-artist='${artistKey}']`);
          if (songEntries.style.display === "none") {
            songEntries.style.display = "block";
          } else {
            songEntries.style.display = "none";
          }
        });
      });
    });
  </script>
}